"use strict";(self.webpackChunksmaply_knowledge=self.webpackChunksmaply_knowledge||[]).push([[8684],{4747:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var s=o(4848),t=o(8453);const i={title:"Service account troubleshooting"},r="Troubleshooting Google Analytics Service Account Access \ud83d\udd0d",c={id:"documentation/metrics/integrations/google-analytics/Administration/service-account-troubleshooting",title:"Service account troubleshooting",description:"If you're experiencing issues with your Google Analytics service account access, this guide will help you diagnose and resolve common problems.",source:"@site/docs/documentation/metrics/integrations/google-analytics/Administration/31-service-account-troubleshooting.md",sourceDirName:"documentation/metrics/integrations/google-analytics/Administration",slug:"/documentation/metrics/integrations/google-analytics/Administration/service-account-troubleshooting",permalink:"/smaply-knowledge/docs/documentation/metrics/integrations/google-analytics/Administration/service-account-troubleshooting",draft:!1,unlisted:!1,editUrl:"https://github.com/geoffbullen/smaply-knowledge/tree/main/docs/documentation/metrics/integrations/google-analytics/Administration/31-service-account-troubleshooting.md",tags:[],version:"current",sidebarPosition:31,frontMatter:{title:"Service account troubleshooting"},sidebar:"docsSidebar",previous:{title:"Creating Google service account",permalink:"/smaply-knowledge/docs/documentation/metrics/integrations/google-analytics/Administration/service-account"},next:{title:"OAuth Authentication for Google Analytics",permalink:"/smaply-knowledge/docs/documentation/metrics/integrations/google-analytics/Administration/o-auth"}},a={},l=[{value:"Test you can access properties",id:"test-you-can-access-properties",level:2},{value:"Running the Diagnostic Script \ud83d\udda5\ufe0f",id:"running-the-diagnostic-script-\ufe0f",level:2},{value:"Test access to individual property \ud83d\udda5\ufe0f",id:"test-access-to-individual-property-\ufe0f",level:2},{value:"Manual Checks \ud83d\udccb",id:"manual-checks-",level:2},{value:"1. Verify Service Account Permissions in Google Analytics",id:"1-verify-service-account-permissions-in-google-analytics",level:3},{value:"2. Check Google Cloud Project Configuration",id:"2-check-google-cloud-project-configuration",level:3},{value:"Common Issues and Solutions \ud83d\udee0\ufe0f",id:"common-issues-and-solutions-\ufe0f",level:2},{value:"Additional Resources \ud83d\udcda",id:"additional-resources-",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"troubleshooting-google-analytics-service-account-access-",children:"Troubleshooting Google Analytics Service Account Access \ud83d\udd0d"}),"\n",(0,s.jsx)(n.p,{children:"If you're experiencing issues with your Google Analytics service account access, this guide will help you diagnose and resolve common problems."}),"\n",(0,s.jsx)(n.h2,{id:"test-you-can-access-properties",children:"Test you can access properties"}),"\n",(0,s.jsx)(n.p,{children:"Google have provided a tool to test your service account can access properties and their fields. It uses oauth rather than the service account, but will test if the properties are valid."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://ga-dev-tools.google/ga4/dimensions-metrics-explorer/",children:"https://ga-dev-tools.google/ga4/dimensions-metrics-explorer/"})}),"\n",(0,s.jsx)(n.h2,{id:"running-the-diagnostic-script-\ufe0f",children:"Running the Diagnostic Script \ud83d\udda5\ufe0f"}),"\n",(0,s.jsx)(n.p,{children:"Here is a Node.js script to help diagnose issues with your service account. Here's how to use it:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Ensure you have Node.js installed on your system."}),"\n",(0,s.jsxs)(n.li,{children:["Save the following script as ",(0,s.jsx)(n.code,{children:"test_ga_sa.js"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'const { google } = require("googleapis");\nconst fs = require("fs");\n\nconst keyFilePath = process.argv[2];\nconst serviceAccountKey = JSON.parse(fs.readFileSync(keyFilePath, "utf8"));\n\nasync function listGAAccountsAndProperties() {\n  const auth = new google.auth.GoogleAuth({\n    credentials: serviceAccountKey,\n    scopes: ["https://www.googleapis.com/auth/analytics.readonly"],\n  });\n\n  const analyticsAdmin = google.analyticsadmin({ version: "v1beta", auth });\n\n  try {\n    console.log("Attempting to list accounts...");\n    const accountSummariesResponse =\n      await analyticsAdmin.accountSummaries.list();\n    const accountSummaries =\n      accountSummariesResponse.data.accountSummaries || [];\n\n    console.log(\n      `Accounts found - data.accountSummaries: ${accountSummaries.length}`\n    );\n    console.log(\n      `Details: ${JSON.stringify(\n        accountSummaries,\n        null,\n        2\n      )}`\n    );\n    console.log(`\\n\\n----------------------------------------\\n\\n`);\n    for (const account of accountSummaries) {\n      console.log(`\\nAccount: ${account.displayName} (${account.name})`);\n\n      const accountId = account.name.split("/")[1];\n\n      console.log(`Listing properties for account ${accountId}...\\n\\n`);\n      const propertiesResponse = await analyticsAdmin.properties.list({\n        filter: `parent:accounts/${accountId}`,\n        pageSize: 200,\n      });\n      const properties = propertiesResponse.data.properties || [];\n\n      console.log(`Properties found: ${properties.length}`);\n\n      properties.forEach((property, index) => {\n        console.log(JSON.stringify(property, null, 2));\n      });\n    }\n  } catch (error) {\n    console.error("Error encountered:");\n    if (error.response) {\n      console.error("  Status:", error.response.status);\n      console.error("  Data:", JSON.stringify(error.response.data, null, 2));\n    } else {\n      console.error("  Message:", error.message);\n    }\n    console.log("\\nPossible reasons for errors:");\n    console.log(\n      "1. The service account does not have access to any Google Analytics accounts or properties."\n    );\n    console.log(\n      "2. There might be an issue with the service account permissions."\n    );\n    console.log(\n      "3. The Analytics Admin API might not be enabled for this project."\n    );\n  }\n}\n\nlistGAAccountsAndProperties();\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Install the required dependencies:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm install googleapis fs\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Run the script, providing the path to your service account key file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node test_ga_sa.js /path/to/your/service-account-key.json\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Analyze the output for any errors or issues."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"test-access-to-individual-property-\ufe0f",children:"Test access to individual property \ud83d\udda5\ufe0f"}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Save the following script as ",(0,s.jsx)(n.code,{children:"test_ga_property.js"}),":"]}),"\n",(0,s.jsx)(n.li,{}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const { google } = require('googleapis');\nconst fs = require('fs');\n\nconst keyFilePath = process.argv[2];\nconst propertyId = process.argv[3];\n\nif (!keyFilePath || !propertyId) {\n  console.error('Usage: node test_ga_property.js <path_to_service_account_key.json> <propertyId>');\n  process.exit(1);\n}\n\nconst serviceAccountKey = JSON.parse(fs.readFileSync(keyFilePath, 'utf8'));\n\nasync function runDiagnostics() {\n  const auth = new google.auth.GoogleAuth({\n    credentials: serviceAccountKey,\n    scopes: ['https://www.googleapis.com/auth/analytics.readonly']\n  });\n\n  const analyticsData = google.analyticsdata({ version: 'v1beta', auth });\n\n  try {\n    console.log(`Running diagnostics for property: ${propertyId}`);\n    console.log('\\nFetching available metrics...');\n    const metadata = await analyticsData.properties.getMetadata({\n      name: `properties/${propertyId}/metadata`\n    });\n\n    console.log('Available metrics:');\n    metadata.data.metrics.forEach(metric => {\n      console.log(`- ${metric.apiName}`);\n    });\n\n    console.log('\\nAttempting to run a simple report...');\n    const report = await analyticsData.properties.runReport({\n      property: `properties/${propertyId}`,\n      resource: {\n        dateRanges: [{ startDate: '30daysAgo', endDate: 'today' }],\n        metrics: [{ name: 'activeUsers' }]\n      }\n    });\n\n    console.log('Report run successfully. Sample data:');\n    console.log(report.data.rows[0].metricValues[0].value);\n\n  } catch (error) {\n    console.error('Error encountered:', error.message);\n    if (error.response) {\n      console.error('Status:', error.response.status);\n      console.error('Data:', JSON.stringify(error.response.data, null, 2));\n    }\n    console.log('\\nPossible reasons for errors:');\n    console.log('1. The service account does not have access to this property.');\n    console.log('2. The property ID is incorrect or doesn\\'t exist.');\n    console.log('3. The Google Analytics Data API is not enabled for this project.');\n    console.log('4. There might be an issue with the service account permissions.');\n  }\n}\n\nrunDiagnostics();\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Run the script, providing the path to your service account key file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node test_ga_property.js /path/to/your/service-account-key.json\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Analyze the output for any errors or issues."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"manual-checks-",children:"Manual Checks \ud83d\udccb"}),"\n",(0,s.jsx)(n.h3,{id:"1-verify-service-account-permissions-in-google-analytics",children:"1. Verify Service Account Permissions in Google Analytics"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Go to ",(0,s.jsx)(n.a,{href:"https://analytics.google.com/",children:"Google Analytics"})]}),"\n",(0,s.jsx)(n.li,{children:"Navigate to Admin > Property > Property Access Management"}),"\n",(0,s.jsx)(n.li,{children:"Ensure your service account email is listed with the correct permissions"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-check-google-cloud-project-configuration",children:"2. Check Google Cloud Project Configuration"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Visit the ",(0,s.jsx)(n.a,{href:"https://console.cloud.google.com/",children:"Google Cloud Console"})]}),"\n",(0,s.jsx)(n.li,{children:"Ensure the Google Analytics Data API is enabled for your project"}),"\n",(0,s.jsx)(n.li,{children:"Verify that your service account exists and has the necessary roles"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"common-issues-and-solutions-\ufe0f",children:"Common Issues and Solutions \ud83d\udee0\ufe0f"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"No properties found"}),": Ensure the service account has been added to the correct Google Analytics property with the right permissions."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"API not enabled"}),": Make sure the Google Analytics Data API is enabled in your Google Cloud project."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Invalid scope"}),": Verify that the correct API scope is being used (",(0,s.jsx)(n.code,{children:"https://www.googleapis.com/auth/analytics.readonly"})," for read-only access)."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Organizational policy restrictions"}),": Work with your organization's admin to review and potentially modify restrictive policies."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"additional-resources-",children:"Additional Resources \ud83d\udcda"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developers.google.com/analytics/devguides/reporting/data/v1",children:"Google Analytics Data API Documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://cloud.google.com/iam/docs/troubleshooting-access",children:"Google Cloud IAM Troubleshooter"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://cloud.google.com/iam/docs/understanding-service-accounts",children:"Understanding Service Accounts"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://cloud.google.com/resource-manager/docs/organization-policy/overview",children:"Google Cloud Organization Policy Documentation"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If you continue to experience issues after following these troubleshooting steps, please contact your organization's Google Cloud administrator or Google Cloud support for further assistance."})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>c});var s=o(6540);const t={},i=s.createContext(t);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);